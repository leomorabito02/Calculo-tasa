<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial General - Calculadora de Renta Fija</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="nav-link">Inicio</a>
        <a href="explicaciones.html" class="nav-link">Explicaciones</a>
        <a href="historial.html" class="nav-link active">Historial General</a>
        <a href="enlaces.html" class="nav-link">Enlaces de InterÃ©s</a>
    </nav>
    <div style="height: 5rem;" aria-hidden="true"></div>
    <h1 class="main-title">Historial de CÃ¡lculos</h1>

    <main class="history-page-container">
        <div class="tabs-container">
            <div class="tabs-nav">
                <button class="tab-btn active" data-tab="tasa">ðŸ“Š Tasa</button>
                <button class="tab-btn" data-tab="rendimiento">ðŸ’° Rendimiento</button>
                <button class="tab-btn" data-tab="compuesto">ðŸ“ˆ InterÃ©s Compuesto</button>
                <button class="tab-btn" data-tab="comparador">ðŸ”€ Comparador</button>
            </div>

            <div class="tab-content active" id="tab-tasa">
                <h2>Historial - Calculadora de Tasa</h2>
                <ul id="historial-tasa-list" class="history-list"></ul>
                <button class="clear-history-btn" onclick="borrarHistorial('historialInversion');actualizarTab('tasa');">Borrar historial</button>
            </div>
            <div class="tab-content" id="tab-rendimiento">
                <h2>Historial - Calculadora de Rendimiento</h2>
                <ul id="historial-rendimiento-list" class="history-list"></ul>
                <button class="clear-history-btn" onclick="borrarHistorial('historialRendimiento');actualizarTab('rendimiento');">Borrar historial</button>
            </div>
            <div class="tab-content" id="tab-compuesto">
                <h2>Historial - InterÃ©s Compuesto</h2>
                <ul id="historial-compuesto-list" class="history-list"></ul>
                <button class="clear-history-btn" onclick="borrarHistorial('historialCompuesto');actualizarTab('compuesto');">Borrar historial</button>
            </div>
            <div class="tab-content" id="tab-comparador">
                <h2>Historial - Comparador</h2>
                <ul id="historial-comparador-list" class="history-list"></ul>
                <button class="clear-history-btn" onclick="borrarHistorial('historialComparador');actualizarTab('comparador');">Borrar historial</button>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <span>Desarrollado por <strong>Leonardo Morabito</strong></span>
            <span>
                <a href="https://github.com/leomorabito02" target="_blank" rel="noopener" class="footer-link">GitHub</a>
                &nbsp;|&nbsp;
                <a href="https://instagram.com/leomorabito2002" target="_blank" rel="noopener" class="footer-link">Instagram</a>
            </span>
        </div>
    </footer>

    <script>
    // --- FORMATO MANUAL OBLIGATORIO ---
    function formatearMoneda(valor) {
        if (valor === "" || valor === undefined || isNaN(valor)) return "0,00";
        let numeroTecnico = parseFloat(valor).toFixed(2);
        let partes = numeroTecnico.split('.');
        partes[0] = partes[0].replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        return partes.join(',');
    }

    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            actualizarTab(this.getAttribute('data-tab'));
        });
    });

    function actualizarTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');
        document.querySelector('[data-tab="' + tabName + '"]').classList.add('active');

        if (tabName === 'tasa') renderizarHistorialTasa();
        else if (tabName === 'rendimiento') renderizarHistorialRendimiento();
        else if (tabName === 'compuesto') renderizarHistorialCompuesto();
        else if (tabName === 'comparador') renderizarHistorialComparador();
    }

    function renderizarHistorialTasa() {
        const historial = JSON.parse(localStorage.getItem('historialInversion') || '[]');
        const ul = document.getElementById('historial-tasa-list');
        ul.innerHTML = '';
        if (historial.length === 0) { ul.innerHTML = '<li style="color:#888;">Sin cÃ¡lculos recientes.</li>'; return; }
        historial.forEach(item => {
            ul.innerHTML += `<li style="margin-bottom:12px;padding:10px 14px;background:#f7f7fa;border-radius:7px;box-shadow:0 2px 8px rgba(0,0,0,0.04);">
                <strong>Capital:</strong> $${formatearMoneda(item.capital)}<br>
                <strong>Final:</strong> $${formatearMoneda(item.montoFinal)}<br>
                <strong>TNA:</strong> ${formatearMoneda(item.tna)}% | <strong>TEA:</strong> ${formatearMoneda(item.tea)}%
            </li>`;
        });
    }

    function renderizarHistorialRendimiento() {
        const historial = JSON.parse(localStorage.getItem('historialRendimiento') || '[]');
        const ul = document.getElementById('historial-rendimiento-list');
        ul.innerHTML = '';
        if (historial.length === 0) { ul.innerHTML = '<li style="color:#888;">Sin cÃ¡lculos recientes.</li>'; return; }
        historial.forEach(item => {
            ul.innerHTML += `<li style="margin-bottom:12px;padding:10px 14px;background:#f7f7fa;border-radius:7px;box-shadow:0 2px 8px rgba(0,0,0,0.04);">
                <strong>Inv:</strong> $${formatearMoneda(item.dinero)}<br>
                <strong>Rend:</strong> $${formatearMoneda(item.rendimientoTotal)}<br>
                <strong>Int:</strong> $${formatearMoneda(item.interesGanado)}
            </li>`;
        });
    }

    function renderizarHistorialCompuesto() {
        const historial = JSON.parse(localStorage.getItem('historialCompuesto') || '[]');
        const ul = document.getElementById('historial-compuesto-list');
        ul.innerHTML = '';
        if (historial.length === 0) { ul.innerHTML = '<li style="color:#888;">Sin cÃ¡lculos recientes.</li>'; return; }
        historial.forEach(item => {
            ul.innerHTML += `<li style="margin-bottom:12px;padding:10px 14px;background:#f7f7fa;border-radius:7px;box-shadow:0 2px 8px rgba(0,0,0,0.04);">
                <strong>Cap:</strong> $${formatearMoneda(item.capital)}<br>
                <strong>Final:</strong> $${formatearMoneda(item.montoFinal)}<br>
                <strong>Rend:</strong> ${formatearMoneda(item.rendimiento)}%
            </li>`;
        });
    }

    function renderizarHistorialComparador() {
        const historial = JSON.parse(localStorage.getItem('historialComparador') || '[]');
        const ul = document.getElementById('historial-comparador-list');
        ul.innerHTML = '';
        if (historial.length === 0) { ul.innerHTML = '<li style="color:#888;">Sin cÃ¡lculos recientes.</li>'; return; }
        historial.forEach(item => {
            const ganador = item.diferenciaAbsoluta > 0 ? 'Plazo Fijo' : 'Billetera Virtual';
            ul.innerHTML += `<li style="margin-bottom:12px;padding:10px 14px;background:#f7f7fa;border-radius:7px;box-shadow:0 2px 8px rgba(0,0,0,0.04);">
                <strong>Cap:</strong> $${formatearMoneda(item.capital)}<br>
                <strong>PF:</strong> $${formatearMoneda(item.montoPlazoFijo)} | <strong>Bill:</strong> $${formatearMoneda(item.montoBilletera)}<br>
                <strong style="color: ${item.diferenciaAbsoluta > 0 ? '#4caf50' : '#ff9800'};">âœ“ ${ganador}</strong>
            </li>`;
        });
    }

    function borrarHistorial(key) {
        localStorage.removeItem(key);
    }

    window.addEventListener('DOMContentLoaded', function() { actualizarTab('tasa'); });
    </script>
</body>
</html>